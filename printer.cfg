[include mainsail.cfg]
#[include helpers.cfg]
[include sovol-macros.cfg]
[include timelapse.cfg]
[include GP3D_Macro.cfg]
[include test_speed.cfg]
[include KAMP_Settings.cfg]
[include status-macros.cfg]
[include new-macros.cfg]
[include steppers.cfg]
#[include carto.cfg]
[include eddy.cfg]
[include fans-and-temp-sensors.cfg]
[include moonraker_obico_macros.cfg]

[include options/lcd/*.cfg]
# [include options/hdmi/*.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_32FFD5054747393934692057-if00
restart_method: command

[mcu extra_mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_50FF69068367515546441367-if00
restart_method: command

[printer]
kinematics: corexy
max_velocity: 700
# printer max 40k
# input shaping says <= 8700 for x, <= 4100 for y
max_accel: 20000
minimum_cruise_ratio: 0.5
max_z_velocity: 20
max_z_accel: 500
square_corner_velocity: 5.0
autosave_path: ../backup

[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[force_move]
enable_force_move: true

[extruder]
rotation_distance: 6.738 #6.745 #6.5
nozzle_diameter: 0.400
filament_diameter: 1.75
# for purge
max_extrude_cross_section: 6

[thermistor my_thermistor_e]
temperature1:25
resistance1:110000
temperature2:100
resistance2:7008
temperature3:220
resistance3:435

[verify_heater extruder]
max_error: 120
check_gain_time:30
hysteresis: 5
heating_gain: 2

[filament_switch_sensor filament_sensor]
pause_on_runout: True
event_delay: 3.0
pause_delay: 0.5
switch_pin: PE9

[thermistor my_thermistor]
temperature1:25
resistance1:100000
temperature2:50
resistance2:18085.4
temperature3:100
resistance3:5362.6

[heater_bed]
heater_pin:PA0
sensor_type: my_thermistor
sensor_pin: PC5
max_power: 1.0
min_temp: 5
max_temp: 105
#control : pid
#pid_kp : 73.571
#pid_ki : 1.820
#pid_kd : 783.849

[verify_heater heater_bed]
max_error: 120
check_gain_time:40
hysteresis: 5
heating_gain: 2

[probe_pressure]
pin: ^!PE12
x_offset: 0
y_offset: 0
z_offset : 0
speed: 1.0

[quad_gantry_level]
gantry_corners:
	-60,-10
	410,420
points:
	36,10
	36,320
	346,320
	346,10
speed: 400
horizontal_move_z: 5 # orig 10
retry_tolerance: 0.02 # orig 0.05 # someone had .008 which is nuts?
retries: 10 # orig 5
max_adjust: 10 # orig 30

[homing_override]
gcode:
  # Move 5 up, just in case (this is our safety zhop, this needs 'set_position_z: 0' below)
  STATUS_HOMING
  G91 ; set relative positioning
  G0 Z5 F1000 ; 5 up zhop
  {% if not rawparams or 'Y' in rawparams|upper %}
    {action_respond_info('Homing Y')}
    G28 Y
    G90 ; set absolute positioning
    G0 Y177.5 F6000 ; return to center
    M400 ; Wait for move to finish
  {% endif %}
  {% if not rawparams or 'X' in rawparams|upper %}
    {action_respond_info('Homing X')}
    G28 X
    G90 ; set absolute positioning
    G0 X177.5 F6000 ; return to center
    M400 ; Wait for move to finish
  {% endif %}
  {% if not rawparams or 'Z' in rawparams|upper %}
    {action_respond_info('Homing Z')}
    G90 ; set absolute positioning
    G0 X177.5 Y177.5 F6000 ; return to center, please add your offsets manually if you want to
    G28 Z
    G91 ; set relative positioning
    G0 Z10 F1000 ; 10mm zhop before probe
    PROBE # Eddy needs a manual PROBE before calling the 'SET_Z_FROM_PROBE'
    SET_Z_FROM_PROBE
    G0 Z5 F1000 ; 5mm up
    M400 ; Wait for move to finish
  {% endif %}
  G90 ; set absolute positioning
  STATUS_READY
axes: xyz
set_position_z: 0 # This forces the z position to be at 0 when we start homing, so we can move the Z up before homing.

[gcode_arcs]
resolution: 1.0

[idle_timeout]
gcode: _IDLE_TIMEOUT
timeout: 600

[pause_resume]

[exclude_object]

[firmware_retraction]

[adxl345]
cs_pin:extra_mcu:PB12

[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 30  # an example175 Y175 Z30
#accel_per_hz:50
min_freq:1
max_freq:120
#max_smoothing:0.2
#hz_per_sec:0.5

[input_shaper]
#damping_ratio_x: 0.001
#damping_ratio_y: 0.001
shaper_type_x = mzv
shaper_freq_x = 54.2
shaper_type_y = mzv
shaper_freq_y = 37

[save_variables]
filename = ~/printer_data/config/saved_variables.cfg

# 	10.050000:3151869.395,15.050156:3149390.215,20.049844:3148564.754,
# 	25.050000:3148201.192

# was 2.492 (automatic)
# was 2.055 (manual)
# was 1.888 -- got some good prints out of this with orange ASA, but then it's terrible
# automatic probe gave me 2.54 after the 1.888
# # manual probing gave me 2.276
## [probe]
## z_offset = 2.246
##

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.052979, 0.043012, 0.022345, 0.020590, 0.018475, 0.024664, 0.013624, 0.009773, -0.001115, 0.006875, 0.010781, 0.011270, 0.015686, 0.006594, 0.014585, 0.024668, 0.020489, 0.028385, 0.018715, 0.037093, 0.038212, 0.027937, 0.026497, 0.030820, 0.043702, 0.047906, 0.031664, 0.036694, 0.049748, 0.059981
#*# 	0.062034, 0.041092, 0.023754, 0.012804, 0.003584, -0.002246, -0.004967, -0.006816, -0.009989, -0.009694, -0.017907, -0.008533, -0.008404, -0.014849, -0.009043, -0.011073, -0.003455, -0.012885, -0.007001, -0.004762, 0.003948, 0.009856, -0.000096, 0.006575, 0.013915, 0.021762, 0.032717, 0.039303, 0.049475, 0.052808
#*# 	0.052235, 0.034793, 0.024234, 0.012198, 0.007214, -0.003138, -0.004675, -0.001393, -0.009681, -0.017056, -0.023352, -0.012728, -0.006480, -0.013164, -0.015858, -0.016588, -0.003985, -0.007742, -0.002604, -0.009551, -0.002631, 0.005120, 0.009352, 0.012264, 0.015359, 0.019378, 0.029456, 0.035577, 0.045490, 0.047911
#*# 	0.060107, 0.044084, 0.031667, 0.024274, 0.019348, 0.017738, 0.006918, 0.005793, 0.002990, 0.005992, -0.000847, -0.001899, 0.000610, 0.001298, -0.001015, 0.000596, -0.005329, 0.005471, 0.009785, 0.017157, 0.017333, 0.019021, 0.023642, 0.026708, 0.025924, 0.033998, 0.043120, 0.049179, 0.054904, 0.051999
#*# 	0.057192, 0.044634, 0.029504, 0.028574, 0.025160, 0.018049, 0.011386, 0.007928, 0.013555, 0.007657, 0.001075, -0.001045, 0.002716, 0.005874, -0.000822, 0.005248, 0.002128, 0.007356, 0.019484, 0.016173, 0.016322, 0.019655, 0.026166, 0.031611, 0.032473, 0.032472, 0.040829, 0.047845, 0.053066, 0.048083
#*# 	0.047312, 0.031623, 0.026072, 0.022998, 0.016017, 0.011253, 0.008688, 0.005529, 0.000737, -0.000205, -0.003739, -0.003113, -0.005810, -0.005156, -0.007512, -0.005300, -0.000999, 0.006920, 0.003103, 0.006698, 0.003650, 0.012825, 0.018829, 0.020144, 0.017462, 0.025225, 0.025230, 0.036745, 0.037675, 0.034989
#*# 	0.051947, 0.038698, 0.032613, 0.026892, 0.020752, 0.017077, 0.013677, 0.005418, 0.004851, 0.004357, 0.000572, -0.000853, -0.000711, -0.008427, 0.003180, 0.002362, 0.003282, 0.004421, 0.007212, 0.009784, 0.012306, 0.013738, 0.016897, 0.021479, 0.021741, 0.028072, 0.031014, 0.033720, 0.036458, 0.034894
#*# 	0.066791, 0.057213, 0.048220, 0.041748, 0.035796, 0.032476, 0.025568, 0.023635, 0.017117, 0.014098, 0.016769, 0.015237, 0.015363, 0.011762, 0.007494, 0.016346, 0.022567, 0.022730, 0.019934, 0.024483, 0.028990, 0.029927, 0.032579, 0.035395, 0.035132, 0.040415, 0.044222, 0.040069, 0.043265, 0.045031
#*# 	0.072246, 0.056265, 0.054986, 0.046921, 0.042396, 0.034912, 0.029056, 0.019688, 0.019921, 0.016212, 0.009592, 0.015721, 0.020561, 0.017549, 0.007445, 0.014939, 0.017134, 0.021200, 0.022148, 0.015491, 0.022381, 0.029130, 0.031771, 0.030188, 0.033271, 0.030617, 0.038612, 0.038564, 0.038502, 0.037563
#*# 	0.068622, 0.053923, 0.046116, 0.033196, 0.028624, 0.027471, 0.017445, 0.012369, 0.008163, 0.007490, 0.007060, 0.006852, 0.009163, 0.007688, 0.006645, 0.004558, 0.010053, 0.010488, 0.013945, 0.014085, 0.015887, 0.014268, 0.018186, 0.020197, 0.018337, 0.020463, 0.020402, 0.021933, 0.019993, 0.020009
#*# 	0.063403, 0.043682, 0.034522, 0.027567, 0.019979, 0.012111, 0.010561, 0.006257, 0.002312, -0.001829, -0.005375, -0.001339, -0.003770, -0.002256, -0.000524, -0.005297, 0.003489, 0.000617, 0.003884, 0.003703, 0.003618, 0.000664, 0.006326, 0.004731, 0.009227, 0.005036, 0.010089, 0.006970, 0.006893, 0.007102
#*# 	0.055683, 0.042506, 0.029364, 0.019731, 0.014858, 0.010798, 0.001457, 0.002834, -0.003397, -0.008113, -0.005703, -0.004159, -0.003489, -0.003522, -0.002687, -0.007883, -0.003655, -0.000409, 0.001207, 0.001686, 0.003086, 0.002633, 0.005263, 0.003967, 0.003981, 0.002908, 0.005651, 0.003236, 0.003024, 0.006928
#*# 	0.044490, 0.032988, 0.023587, 0.016090, 0.009575, 0.005496, -0.002438, -0.006373, -0.008158, -0.008549, -0.013677, -0.009414, -0.007525, -0.008686, -0.011276, -0.011543, -0.013101, -0.011248, -0.010614, -0.007041, -0.003086, -0.003070, -0.001346, 0.000217, -0.000446, 0.001945, 0.000754, -0.003197, -0.002197, 0.001394
#*# 	0.050359, 0.035052, 0.023168, 0.017039, 0.010858, 0.007057, -0.001325, -0.004896, -0.005997, -0.009026, -0.009058, -0.010924, -0.005351, -0.002954, -0.006866, -0.006100, -0.004872, -0.008878, -0.005577, -0.006732, -0.001809, -0.001030, -0.002796, -0.004303, -0.001042, 0.003706, 0.001509, 0.003387, 0.002371, 0.002700
#*# 	0.060259, 0.047416, 0.031815, 0.023174, 0.017513, 0.014477, 0.006019, 0.005652, 0.001752, 0.003497, 0.003158, 0.005553, 0.006189, 0.004175, 0.001624, 0.003993, 0.000595, 0.006943, 0.002926, 0.005891, 0.004273, 0.004391, 0.007211, 0.008095, 0.010554, 0.007297, 0.010173, 0.011161, 0.014836, 0.011283
#*# 	0.059926, 0.049318, 0.034429, 0.028784, 0.026528, 0.020057, 0.012335, 0.006935, 0.006968, 0.005002, 0.004357, 0.003813, 0.005445, 0.005286, 0.002502, 0.006159, 0.003716, 0.010280, 0.002878, 0.006977, 0.009224, 0.008079, 0.007329, 0.007651, 0.008110, 0.007411, 0.010318, 0.004853, 0.010888, 0.010435
#*# 	0.039197, 0.029231, 0.018903, 0.013882, 0.010931, 0.006827, 0.005704, -0.001670, -0.002770, -0.008053, -0.005502, -0.006568, -0.007288, -0.005677, -0.008439, -0.005508, -0.004191, -0.004282, -0.005420, -0.003499, -0.005103, -0.007686, -0.003201, -0.004888, -0.006769, -0.008046, -0.009298, -0.011540, -0.004875, -0.004840
#*# 	0.043713, 0.028378, 0.017445, 0.010788, 0.007229, 0.003566, -0.000086, 0.000101, -0.001459, -0.002155, -0.004395, -0.004027, -0.001750, -0.004975, -0.005011, -0.002287, -0.004788, -0.001954, -0.003368, -0.003428, -0.004539, -0.003795, -0.005490, -0.004797, -0.008719, -0.008702, -0.008135, -0.009258, -0.011680, -0.003693
#*# 	0.057582, 0.041297, 0.027290, 0.030429, 0.021842, 0.017392, 0.013934, 0.010645, 0.012565, 0.010499, 0.006935, 0.009509, 0.011659, 0.008505, 0.009382, 0.011064, 0.007187, 0.006126, 0.007333, 0.012187, 0.009786, 0.009130, 0.006155, 0.008682, 0.005134, 0.005381, 0.002953, -0.000872, -0.000601, 0.008916
#*# 	0.068766, 0.053666, 0.043043, 0.042120, 0.034325, 0.028952, 0.030426, 0.027904, 0.027823, 0.026400, 0.022396, 0.024252, 0.020640, 0.026324, 0.023053, 0.021769, 0.023964, 0.024608, 0.024516, 0.024728, 0.026429, 0.025060, 0.024589, 0.022826, 0.020746, 0.023210, 0.019608, 0.015389, 0.014337, 0.020158
#*# 	0.070916, 0.059008, 0.052177, 0.047213, 0.044665, 0.038654, 0.033084, 0.036457, 0.034212, 0.030350, 0.032717, 0.031473, 0.034370, 0.030105, 0.030639, 0.032633, 0.034129, 0.034804, 0.034801, 0.031350, 0.032527, 0.033209, 0.034868, 0.032516, 0.035583, 0.030234, 0.029017, 0.024791, 0.022205, 0.028648
#*# 	0.078572, 0.063161, 0.052745, 0.047150, 0.044403, 0.040598, 0.041947, 0.035697, 0.036529, 0.040235, 0.038305, 0.038087, 0.038275, 0.038874, 0.037671, 0.038300, 0.038805, 0.036980, 0.035976, 0.038788, 0.040154, 0.039445, 0.041449, 0.037738, 0.039255, 0.037300, 0.037885, 0.031457, 0.029422, 0.036279
#*# 	0.079305, 0.062748, 0.052403, 0.045582, 0.043282, 0.040694, 0.039765, 0.033988, 0.036750, 0.035265, 0.035599, 0.035882, 0.033910, 0.037281, 0.032647, 0.033281, 0.036185, 0.041910, 0.038339, 0.041715, 0.044648, 0.039799, 0.039692, 0.039106, 0.039045, 0.037441, 0.038212, 0.032264, 0.030509, 0.038319
#*# 	0.055771, 0.043677, 0.035800, 0.031397, 0.033665, 0.026922, 0.024435, 0.021442, 0.023637, 0.021934, 0.025776, 0.022455, 0.023396, 0.024749, 0.022106, 0.021725, 0.026327, 0.033420, 0.032464, 0.032251, 0.032491, 0.031834, 0.031368, 0.029230, 0.031781, 0.033540, 0.034158, 0.027803, 0.024860, 0.033549
#*# 	0.048265, 0.036630, 0.030940, 0.022968, 0.020019, 0.018508, 0.018035, 0.016975, 0.014791, 0.013377, 0.013688, 0.016538, 0.016727, 0.015475, 0.015942, 0.016084, 0.017860, 0.020823, 0.022230, 0.027165, 0.024161, 0.023874, 0.023835, 0.030721, 0.027111, 0.032959, 0.025330, 0.021688, 0.019961, 0.027625
#*# 	0.042826, 0.032276, 0.020909, 0.015165, 0.013209, 0.009775, 0.007458, 0.006634, 0.008386, 0.010066, 0.007884, 0.007449, 0.011098, 0.012659, 0.009561, 0.014726, 0.011508, 0.015648, 0.015650, 0.017631, 0.021616, 0.020131, 0.018045, 0.020391, 0.021917, 0.023615, 0.023836, 0.023037, 0.020718, 0.035770
#*# 	0.038859, 0.024338, 0.015451, 0.009268, 0.006940, 0.003976, -0.000506, 0.000020, 0.003128, 0.001985, 0.000139, 0.002518, 0.008252, 0.008553, 0.002802, 0.006002, 0.008921, 0.009605, 0.009350, 0.011940, 0.011870, 0.013019, 0.015373, 0.017457, 0.019587, 0.019769, 0.022453, 0.021707, 0.022357, 0.031681
#*# 	0.032582, 0.017224, 0.009728, 0.000974, -0.003876, -0.006047, -0.009354, -0.008861, -0.006807, -0.003294, -0.008776, -0.007979, -0.007038, -0.006976, -0.005714, -0.003445, -0.002245, -0.000553, -0.001091, -0.001634, 0.003934, 0.006211, 0.005934, 0.008385, 0.009993, 0.014522, 0.018224, 0.020728, 0.020792, 0.028018
#*# 	0.036752, 0.022210, 0.009852, 0.003034, -0.000159, -0.003964, -0.008778, -0.010847, -0.005695, -0.006211, -0.008902, -0.007264, -0.006219, -0.002724, -0.006215, -0.005292, -0.003636, 0.000005, -0.002140, -0.001031, -0.000109, 0.004689, 0.005656, 0.008428, 0.011152, 0.013267, 0.017601, 0.023647, 0.028376, 0.036506
#*# 	0.062613, 0.048947, 0.027246, 0.015185, 0.008147, 0.009283, -0.002864, -0.002998, -0.002582, -0.000823, 0.000435, -0.003532, 0.002878, 0.003206, 0.001632, 0.009614, 0.014057, 0.008894, 0.012737, 0.008607, 0.013361, 0.015430, 0.018339, 0.028062, 0.023745, 0.027670, 0.036115, 0.043030, 0.050808, 0.058879
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.5
#*# min_x = 20.0
#*# max_x = 330.0
#*# min_y = 20.0
#*# max_y = 330.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.832
#*# pid_ki = 4.315
#*# pid_kd = 44.878
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 73.349
#*# pid_ki = 1.948
#*# pid_kd = 690.394
#*#